#     _____ __    _____
#    |     |  |  |_   _|  C++ Object Libraries for IBM i
#    |  |  |  |__ _| |_   File:   BUILD/makefile.txt
#    |_____|_____|_____|  Author: Sergey Chebotarev
#     





#***** ОПЦИИ КОМПИЛЯЦИИ И СБОРКИ ***************************************************************************************
!if $(debug) == 0
tmplib   = QTEMP
optimize = DBGVIEW(*NONE) OPTIMIZE(40) INLINE(*ON) 
define   = DEFINE('__IBMCPP_TR1__=1' 'NDEBUG')

!else
tmplib   = $(dstlib)
optimize = DBGVIEW(*ALL) OPTIMIZE(20)
define   = DEFINE('__IBMCPP_TR1__=1' 'DEBUG')
!endif

options  = LANGLVL(*EXTENDED0X) PFROPT(*STRDONLY) +
           CHECKOUT(*CLASS *COND *EFFECT *GENERAL *GOTO *LANG *PARM *REACH *TRUNC *UNUSED)
linker   = BNDSRVPGM(QYPPRT370 QYPPSL510)





#***** ПОЛНАЯ СБОРКА ***************************************************************************************************
all: $(dstlib)/OLITEST<PGM>

$(dstlib)/OLITEST<PGM>: $(tmplib)/MAIN<MODULE> $(tmplib)/FMT<MODULE> $(tmplib)/STL<MODULE> $(tmplib)/STRING<MODULE> +
                        $(dstlib)/GOOGLE\$<MODULE> $(dstlib)/FMT\$<MODULE>
   -DLTBNDDIR  BNDDIR($(dstlib)/OLI)
    CRTBNDDIR  BNDDIR($(dstlib)/OLI)
    ADDBNDDIRE BNDDIR($(dstlib)/OLI) +
               OBJ(($(dstlib)/GOOGLE\$ *MODULE) ($(dstlib)/FMT\$ *MODULE))
   -DLTPGM     PGM($(@L)/$(@F))
    CRTPGM     PGM($(@L)/$(@F)) +
               MODULE($(tmplib)/MAIN $(tmplib)/FMT $(tmplib)/STL $(tmplib)/STRING) +
               BNDDIR($(dstlib)/OLI) +
               $(linker)





#***** ПОЛНАЯ ОЧИСТКА **************************************************************************************************
clean:
   -DLTPGM     PGM($(dstlib)/OLITEST)
   -DLTBNDDIR  BNDDIR($(dstlib)/OLI)
   -DLTMOD     MODULE($(dstlib)/GOOGLE\$)
   -DLTMOD     MODULE($(dstlib)/FMT\$)
   -DLTMOD     MODULE($(tmplib)/MAIN)
   -DLTMOD     MODULE($(tmplib)/FMT)
   -DLTMOD     MODULE($(tmplib)/STL)
   -DLTMOD     MODULE($(tmplib)/STRING)





#***** СБОРКА МОДУЛЕЙ БИБЛИОТЕКИ ***************************************************************************************
$(dstlib)/GOOGLE\$<MODULE>: $(srclib)/GTEST.GOOGLE $(srclib)/GMOCK.GOOGLE $(srclib)/GOOGLE\$.GOOGLE
   -DLTMOD     MODULE($(@L)/$(@F))
    CRTCPPMOD  MODULE($(@L)/$(@F)) SRCFILE($(srclib)/GOOGLE) SRCMBR($(@F)) +
               $(optimize) $(define) $(options)

$(dstlib)/FMT\$<MODULE>: $(srclib)/FORMAT\$.FMT $(srclib)/FORMAT.FMT
   -DLTMOD     MODULE($(@L)/$(@F))
    CRTCPPMOD  MODULE($(@L)/$(@F)) SRCFILE($(srclib)/FMT) SRCMBR(FORMAT\$) +
               $(optimize) $(define) $(options)





#***** ОПИСАНИЕ ЗАВИСИМОСТЕЙ МОДУЛЕЙ ЮНИТ-ТЕСТОВ ***********************************************************************
$(tmplib)/MAIN<MODULE>: +
    $(srclib)/MAIN.TEST $(srclib)/GTEST.GOOGLE

$(tmplib)/FMT<MODULE>: +
    $(srclib)/FMT.TEST $(srclib)/FORMAT.FMT $(srclib)/GTEST.GOOGLE

$(tmplib)/STL<MODULE>: +
    $(srclib)/STL.TEST $(srclib)/TYPE_TRAIT.STL $(srclib)/UTILITY.STL $(srclib)/MEMORY.STL +
    $(srclib)/MAP.STL $(srclib)/ITERATOR.STL +
    $(srclib)/DEFINE.STL

$(tmplib)/STRING<MODULE>: +
    $(srclib)/STRING.TEST $(srclib)/STRING.ICORE +
    $(srclib)/DEFINE.ICORE $(srclib)/TYPE_TRAIT.STL $(srclib)/ITERATOR.STL $(srclib)/CSTDDEF.STL +
    $(srclib)/DEFINE.STL





#***** ПРАВИЛО КОМПИЛЯЦИИ МОДУЛЕЙ ЮНИТ-ТЕСТОВ **************************************************************************
$(tmplib)/MAIN<MODULE> $(tmplib)/FMT<MODULE> $(tmplib)/STL<MODULE> $(tmplib)/STRING<MODULE>:
   -DLTMOD     MODULE($(@L)/$(@F))
    CRTCPPMOD  MODULE($(@L)/$(@F)) SRCFILE($(srclib)/TEST) SRCMBR($(@F)) +
               $(optimize) $(define) $(options)
